<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sound Drawing Studio</title>

<style>
    body {
        margin: 0;
        font-family: sans-serif;
        background: #f2f2f2;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
    }

    .container {
        display: flex;
        gap: 20px;
    }

    .tools {
        width: 220px;
        background: white;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .tools h3 {
        margin-top: 0;
    }

    .tools button, .tools select, .tools input {
        width: 100%;
        margin-top: 8px;
        padding: 8px;
        border-radius: 6px;
        border: 1px solid #aaa;
        cursor: pointer;
    }

    #canvas {
        background: white;
        box-shadow: 0 2px 10px rgba(0,0,0,0.15);
        border-radius: 10px;
        width: 842px;
        height: 690px;
        cursor: crosshair;
    }
</style>
</head>

<body>

<div class="container">

    <div class="tools">
        <h3>Tools</h3>

        <label>Music</label>
        <select id="music">
            <option value="https://open.spotify.com/embed/track/2X7LHd75d3EtQgsAiJi1S8">Track 1</option>
            <option value="https://open.spotify.com/embed/track/7biZOldbger5MgwcgE6CaA">Track 2</option>
            <option value="https://open.spotify.com/embed/track/2X7LHd75d3EtQgsAiJi1S8">Track 3</option>
        </select>

        <iframe id="player" style="margin-top:10px;border-radius:8px;" 
                width="100%" height="130"
                frameBorder="0"
                allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture">
        </iframe>

        <label>Color</label>
        <input type="color" id="colorPicker">

        <label>Tool Size</label>
        <input type="range" id="size" min="2" max="80" value="10">

        <button onclick="setMode('draw')">Free Draw</button>
        <button onclick="setMode('erase')">Eraser</button>

        <button onclick="setStamp('circle')">Circle Stamp</button>
        <button onclick="setStamp('square')">Square Stamp</button>
        <button onclick="setStamp('triangle')">Triangle Stamp</button>

        <button style="background:#ffdddd" onclick="clearCanvas()">Clear</button>

        <!-- NEW SAVE BUTTON -->
        <button onclick="saveImage()">Save Artwork</button>
    </div>

    <canvas id="canvas" width="842" height="595"></canvas>
</div>



<script>
const player = document.getElementById("player");
const music = document.getElementById("music");
player.src = music.value;
music.addEventListener("change", () => {
    player.src = music.value;
});

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let drawing = false;
let mode = "draw";
let stampShape = null;

function setMode(m) {
    mode = m;
    stampShape = null;
}

function setStamp(shape) {
    mode = "stamp";
    stampShape = shape;
}

function clearCanvas() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
}

canvas.addEventListener("mousedown", start);
canvas.addEventListener("mousemove", draw);
canvas.addEventListener("mouseup", () => drawing = false);
canvas.addEventListener("mouseleave", () => drawing = false);

function start(e) {
    drawing = true;
    draw(e);
}

function draw(e) {
    if (!drawing) return;

    const x = e.offsetX;
    const y = e.offsetY;
    const color = document.getElementById("colorPicker").value;
    const size = document.getElementById("size").value;

    if (mode === "draw") {
        ctx.lineWidth = size;
        ctx.lineCap = "round";
        ctx.strokeStyle = color;
        ctx.lineTo(x, y);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(x, y);
    }

    if (mode === "erase") {
        ctx.lineWidth = size;
        ctx.lineCap = "round";
        ctx.strokeStyle = "white";
        ctx.lineTo(x, y);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(x, y);
    }

    if (mode === "stamp") {
        ctx.fillStyle = color;
        ctx.beginPath();

        if (stampShape === "circle") {
            ctx.arc(x, y, size, 0, 2 * Math.PI);
        }
        if (stampShape === "square") {
            ctx.rect(x - size/2, y - size/2, size, size);
        }
        if (stampShape === "triangle") {
            ctx.moveTo(x, y - size);
            ctx.lineTo(x - size, y + size);
            ctx.lineTo(x + size, y + size);
        }

        ctx.fill();
        drawing = false;
    }
}

/* ----- NEW SAVE FUNCTION ----- */
function saveImage() {
    const link = document.createElement('a');
    link.download = 'sound-drawing.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
}
</script>

</body>
</html>
